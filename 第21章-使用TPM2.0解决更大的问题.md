# 使用TPM2.0解决更大的问题
纵观全书，我们已经介绍了怎样在程序中使用TPM命令的例子。这一章将关注怎样组合几种命令来创建一个使用多种TPM功能的应用程序。这样的程序在TPM1.2中并不容易实现，但是TPM2.0已经增加了一些功能来解决这些问题。

## 通过使用EK的IDevIDs来远程配置PC
每一个客户端的TPM都会有一个EK。它是一个存储秘钥，并且还附带一个能够证明它来自一个真实TPM的证书。一个企业可能会有一个EK证书列表，证书分别对应这个企业购买的客户端机器。企业很可能会希望每个系统上有一个唯一的签名秘钥（通常叫做IDevID），它可以用于初始化一个VPN连接。但是，EK作为一个存储秘钥，不能用作VPN秘钥。TPM1.2有一个复杂的协议可以用于创建一个TPM签名秘钥的证书，这个证书可以证明这个秘钥是在TPM中创建的。但是，并没有商业上可用的CA机构支持这个协议。

TPM2.0EK比1.2EK的鲁棒性更强。一个2.0EK可以用加密其他的秘钥。具体来讲，一个企业可以创建一个限制性签名秘钥，然后用EK加密，这样一来，只有拥有这个EK的的TPM可以导入这个秘钥。这与现在用于配置秘钥的“发送一个PKCS#12文件”技术类似（TPM这个更安全）。通过这样的方式，包含私钥的PKCS#12文件会被创建并发送到客户端。然后客户端还会通过旁路收到一个口令，这个口令用于解密刚刚收到的PK12文件；然后将解密出的私钥部分存储在安全的地方。这种技术会可能将私钥暴露，安全性与口令相当。相比之下，TPM的协议更加安全。

有三种方式可以将一个签名秘钥声称为IDevID：
* 技术1：在服务器端的TPM或者TPM模拟器中创建IDevID，然后使用标准的CA创建这个秘钥的证书。然后执行TPM复制秘钥操作，从而使拥有客户端EK的系统能够导入这个秘钥。这个过程叫做复制这个秘钥，秘钥的新父秘钥是客户端系统的EK。
* 技术2：（在TPM外部）创建一个IDevID秘钥并认证它。将它加密从而使秘钥看起来像一个复制过的秘钥，这样就可以被导入到客户端的EK下。
* 技术3：（在TPM外部）创建一个IDevID秘钥并认证它。将秘钥导入本地的TPM或者TPM模拟器中，然后像技术1一样将秘钥复制到客户端系统的EK下。

这三种技术在实现上有稍许不同，接下来我们将介绍。

### 技术1
### 技术2
### 技术3
## 数据备份
## 特权隔离
## 使服务器的登录变安全
## 将固件锁定在嵌入式系统中，但是允许更新
## 总结
