# 授权和会话
授权和会话是TPM2.0规范中最重要的概念之一。授权用于控制TPM实体的访问，它为TPM提供了很多安全保证。会话是授权的引擎，并且也会维护多个命令之前的状态。除此之外，会话还用于配置一些命令相关的属性，比如说密令和命令响应参数以及审计的加密和解密操作。这一章介绍会话是因为他们与实体的授权动作相关。第16，17章将介绍命令会话相关的会话使用修饰符细节。

授权和会话是一个范围很大的话题，所以这张将会按照以下的过程介绍：
1. 授权你将学习针对授权和会话的新概念。
2. 你将会从较高的层次了解口令，HMAC，和policy授权，同时还有它们各自的安全属性。
3. 这一章会澄清会话和授权的异同，同时还有一些可能让人混淆的规范文档中的内容。
4. 你将深入学习授权的放方方面面，它们都适用于以下三种授权：口令，HMAC，以及Policy。你将会学习授权角色，以及命令和命令响应字节流中的授权区域。
5. 你将会详细的研究不同授权类型，从最简单到最复杂的口令，HMAC和Policy。介绍完口令授权以后，你将会首先了解一些HMAC和Policy授权的共同点，然后分别介绍这两种授权的详细内容。
6. 最后，所有的授权类型组合到一起形成混合型授权生命周期。

这一章不会描述各种各样的Policy授权命令。也不会介绍加密，解密和审计会话，只是提醒读者会话是这些操作的引擎。

这一章会使用图表，逻辑流，以及可以运行的代码示例来描述授权和会话是怎样工作的。这些材料是理解TPM2.0的基础。准备好艰难但会收获满满的学习旅程吧。

## 会话相关的定义
在我们深入挖掘授权和会话这个主题之前，我们需要清楚地理解一些新的概念。这些概念不在我们第5章介绍的概念范围之内。在阅读本章后续的内容时需要参考第5章的概念以及以下几个新的概念：
* 会话创建的变量：这些变量是在会话创建时设置的，并且会在会话生命周期内一直存在。它们用于决定会话和HMAC密钥是怎样创建的，以及HMAC是怎样生成的。一共有两种选择：bound和unbound，以及salted和unsalted。这两种选择的组合构成了四个会话变种。后续我们会详细地介绍它们。现在我们仅仅做一些概括的介绍：
  * Bound会话实际上就是将授权与一些实体的授权值绑定。这个绑定是通过将被绑定实体的授权值加入到会话密钥创建过程中。这个会影响到所有依赖会话密钥的计算，包括HMAC，policy，加解密计算。
  * 一个Unbound会话就是在会话密钥生成过程中不使用其他实体的授权信息。
  * 一个Salted会话会增加额外的熵值，这个盐，会被加入到会话密钥创建过程中；这与bound会话，它也同样会影响到依赖会话密钥的计算。这个额外的熵值是以加密的形式被发送到TPM设备中的，加密过的盐参数会被TPM2_StartAuthSession命令使用。
  * 一个Unsalted会话就是创建会话时不加入额外的熵值。
* 会话使用修饰符：这些修饰符会改变HMAC和Policy会话在一次命令中的行为。Continue，encrypt，decrypt，以及audit是比较常用的几种修饰符：
  * Continue：如果不设置，这个会话在命令执行成功后就会终止。
  * Decrypt：用于指示发送到TPM设备的第一个TPM2B命令参数是加密过的。
  * Encrypt：用于指示TPM设备将发送过来的命令响应的第一个TPM2B参数进行加密。
  * Audit：指示命令使用这个会话的命令要被审计。
在以上概念的基础上，我们就可以描述不同类型的会话了。

## 口令，HMAC，和Policy会话：它们都是什么？

## 会话的授权：对比与差别
## 授权角色
## 命令和命令响应的授权区域详解
### 命令授权区域
### 命令授权结构体
### 响应授权结构体
## 口令授权：最简单的授权
### 口令授权的生命周期
### 创建一个使用口令授权的实体
### 修改已有实体的授权口令
### 使用一个口令授权
### 代码示例：口令会话
## 启动HMAC和Policy会话
### TPM2_StartAuthSession命令
### 会话密钥和HMAC密钥的详细信息
### TPM2_StartAuthSession命令的handle和参数指导
### 会话的变量
#### Salted vs. Unsalted
#### Bound vs. Unbound
#### 会话变种的应用案例
## HMAC和Policy会话的不同
## HMAC授权
### HMAC授权生命周期
#### 修改或者创建一个使用HMAC授权的实体
#### 创建一个HMAC会话
#### 使用HMAC来授权单独地一次命令
### HMAC和Policy会话的代码示例
### 使用HMAC会话来发送多次命令（Rolling Nonces）
### HMAC会话的安全性
### HMAC会话的数据结构
## Policy授权
### EA是怎样工作的？
### Policy授权的时间间隔
### Policy授权的生命周期
#### 创建实体的Policy摘要
#### 使用Policy摘要创建一个实体
#### 开启一个真正的Policy会话
#### 发送Policy相关的命令来满足Policy
#### 执行需要Policy授权的动作
## 符合的授权生命周期
## 总结
