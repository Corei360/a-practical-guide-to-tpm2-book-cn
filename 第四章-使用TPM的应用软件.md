# 使用TPM的应用软件
尽管已经有10亿以上的TPM设备被部署在商业个人电脑和服务器上，仍然仅有很少人知道TPM。同时当许多知道TPM的人了解到已经有很多针对TPM的应用时也会感到惊喜（这说明TPM的广泛应用和被人熟知还有很长的路要走）。其实现在有很多种方法来帮助我们编写应用TPM1.2设备的软件。对于TPM2.0来说，因为现在仍处于应用的初期，所以我们看不到很多可直接应用TPM2.0的软件也不足为奇了。这本书的目的就是帮助你基于TPM2.0的基本功能和高级功能开发相关的应用程序。

这一章首先介绍各种各样用于和TPM硬件交互的软件接口。然后介绍几个已经在使用TPM的应用。这其中我们会指出一些在我们看来应该使用但却没有使用的软件（期望读者可以改进它们），这或许是这个章节中最有意思的部分。

最后我们还给程序员提出一些在使用TPM开发应用时的一些建议和他们应该注意的地方，以及当前应用软件是如何处理与之相关的问题的。

## 用于和TPM设备通信的应用软件接口
当前使用TPM1.2和TPM2.0的软件有很多中类型，我们可以根据它们使用的应用程序接口分为以下几类：
* 直接使用TPM设备的私有软件
* 使用中间件来和TPM设备通信的旧应用，比如说PKCS#11和微软的CAPI。当PKCS#11可以在TPM2.0上使用时，这些应用仍然可以使用。这些软件在所有支持TPM1.2的操作系统上都是可用。微软的CAPI更是从Win8就开始同时支持TPM1.2和TPM2.0。
* 使用TSS接口来和TPM设备通信的应用（IBM，Infineon和NCP都有自己私有的TSS，同时也有叫做TrouSerS的开源TSS。注：现在它们应该是全部转向TPM2-TSS（github）了）。当然这些都是针对TPM1.2的，同时他们也正在如火如荼地开发TPM2.0版本的接口。
* 使用JAVA接口来和TPM设备通信的应用。目前仅有TPM1.2版本的软件，不过TPM2.0版本的软件应该很快就会出现。使用JAVA接口的设备主要是移动设备，尤其是运行Android系统的平台
* 使用微软TBS（TPM Base Services）的windows应用。它们可以支持TPM1.2和TPM2.0。当然新规范中增加的功能只有TPM2.0设备才支持。
* 支持TPM2.0的微软TSS.net，它同时附带有一个TPM2.0模拟器。不过需要说明的是，TSS.net不兼容TCG标准，并且现在只能在Windows平台上应用。

第一代使用TPM的软件是在具有第一版TPM的设备上运行的私有软件。比如说IBM的口令管理器和文件系统加密器，它们使用TPM来加密软件中涉及的密钥。Dell，HP，Infineon也有各种各样的类似软件。一般来说，这类软件运行良好，但是它们都是功能比较单一的应用案例。

另外一类使用TPM的应用来自于密码服务供应商（CryptographicServiceProviders）。它们主要包含两种主要类型：一种使用CAPI，另外一种使用RSA公司的PKCS#11。任何应用都可以通过这两种API来使用TPM的密码学服务。幸运的是，大多数软件都使用了以上两种API，使用它们的好处是显而易见的。大家都知道，开发密码学接口是非常困难的，尤其是在需要考虑容易受到攻击的地方，比如如何防止侧信道攻击。目前比较靠谱的方式就是让密码学专家来实现这些密码服务接口。另外，在政府应用环境中，这些密码学服务需要通过NIST的相关认证才能被使用。

以上两种API都提供一些钩子接口，它们可以用来替换那些之前用软件来实现的密码学服务。这个特性可以利用TPM基于硬件的密码服务接口来抵御软件攻击。在window上，使用CAPI和PKCS接口的此类密码服务供应商都有。比如，SecurityInnovation，WaveSystems，Infineon和Lenovo都有类似的实现。这种密码服务通常是和计算机供应商绑定在一起的。值得注意的是，Infineon的CSP可以检测系统中可以使用他们服务的应用，从而让用户通过它们的服务来使用TPM。在其他的操作系统上，比如Linux，BSD，MAC OS，Solaris，PKCS#11实现了使用TPM产生公钥和随机数。并且这些实现是免费的。另外，一些公司也实现了中间件来用于构建基于TPM的密码服务，比如Charismathics。


