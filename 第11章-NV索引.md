# NV索引
TPM使用非易失性内存来存储两种类型的数据：
* TPM架构定义的数据结构。
* 用户或者平台相关的规范定义的非结构性数据。

TPM非易失性内存的一个应用是用于存储架构或者TPM软件规范定义的数据。这些数据包括授权值，种子，凭据以及TPM从不会暴露在安全边界之外的私有数据。除此之外，这些数据还包括计数器，时钟，以及其他用户可以读取的数据。非易失性内存也可以用于存储被配置成持续性的数据结构，比如秘钥。

本小节我们将介绍NV内存的另外一个使用案例：作为平台或者用户自定义的内存空间。因为是用户为每一个区域分配一个索引并使用这个索引来访问数据，所以有时候这又被称为用户自定义索引。

TPM1.2中包含可以存储自定义数据的用户索引。索引的大小和属性由用户来决定。用户可以不受限制地向索引的内存区域写数据。TPM为这些索引提供授权机制，可以提供基于HMAC，PCR，locality，和物理存在（physical presence）的访问控制；另外TPM提供索引的读写锁定机制。

TPM2.0在以下几个方面TPM1.2NV相关的特性：
* 一个索引有一个状态叫做“未初始化的，没有被写过”。在第一次写操作之前的读操作都将失败。更进一步，索引不能被用于policy。这样可以向这个索引的使用者保证这个索引的值一定是被具有授权权限的一方初始化过的，而不是简单默认值或者未初始化值。
* 与其他受保护的实体一样，TPM2.0的索引可以有授权值或者policy。
* 另外一个policy可以包含一个NV索引的值。这个policy可以对索引或者索引的一部分设定一个操作：比如跟policy数据对比。操作包括相等，不相等，有符号比较，无符号比较，以及检查某一位置位或者清零。

NV索引的另外一个新特性是数据类型。TPM2.0在1.2版本的非结构化数据（现在叫做普通数据）的基础上增加了另外三种类型，所以一共有四种类型：
* 普通。
* 计数器。
* 位域。
* 扩展。

## 普通NV索引
### NV计数器索引
### NV位域索引
### NV扩展索引
### 混合索引
### NV访问控制
### NV写操作
### NV索引的handle值
### NV名称
### NV口令
## NV相关的命令
## 总结
